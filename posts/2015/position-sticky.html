<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>position-stickyについて調べたメモ - 1000ch.net</title>

<link rel="icon" href="/favicon.png">
<link rel="shortcut icon" href="/favicon.png">
<link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml" sizes="any">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto Mono:400,700">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/github.min.css">
<link rel="stylesheet" href="/css/app.min.css">
<link rel="alternate" href="/rss.xml" title="1000ch.net" type="application/rss+xml">

<meta name="author" content="Shogo Sensui">
<meta name="copyright" content="Copyright (c) Shogo Sensui; Licensed under Creative Commons Attribution-Noncommercial-Share Japan">


  
    <meta name="description" content="position-stickyについて調べたメモ 業務中にposition: sticky;的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。 Fixed-sticky - filamentgroup Demo: Position Sticky 広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されているposition: fixed;と言えばいいんだろうか。 スペックなど Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012) 6.2. Sticky positioning - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 6.7. Choosing a positioning scheme: position property - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。 Why doesn&rsquo;t position: sticky work in Chrome? - Stack Overflow Issue 231752: Meta bug for position:sticky - Chromium Dashboard Remove position: sticky We would eventually like to implement position: sticky, but the current implementation isn&rsquo;t designed in a way that integrates well with the existing scrolling and compositing system.">
    <meta property="og:description" content="position-stickyについて調べたメモ 業務中にposition: sticky;的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。 Fixed-sticky - filamentgroup Demo: Position Sticky 広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されているposition: fixed;と言えばいいんだろうか。 スペックなど Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012) 6.2. Sticky positioning - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 6.7. Choosing a positioning scheme: position property - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。 Why doesn&rsquo;t position: sticky work in Chrome? - Stack Overflow Issue 231752: Meta bug for position:sticky - Chromium Dashboard Remove position: sticky We would eventually like to implement position: sticky, but the current implementation isn&rsquo;t designed in a way that integrates well with the existing scrolling and compositing system.">
    <meta name="twitter:description" content="position-stickyについて調べたメモ 業務中にposition: sticky;的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。 Fixed-sticky - filamentgroup Demo: Position Sticky 広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されているposition: fixed;と言えばいいんだろうか。 スペックなど Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012) 6.2. Sticky positioning - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 6.7. Choosing a positioning scheme: position property - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module 仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。 Why doesn&rsquo;t position: sticky work in Chrome? - Stack Overflow Issue 231752: Meta bug for position:sticky - Chromium Dashboard Remove position: sticky We would eventually like to implement position: sticky, but the current implementation isn&rsquo;t designed in a way that integrates well with the existing scrolling and compositing system.">
  

  
    <meta property="og:image" content="https://1000ch.net/favicon.svg">
    <meta name="twitter:image" content="https://1000ch.net/favicon.svg">
  


<meta property="og:type" content="article">
<meta property="og:url" content="https://1000ch.net/posts/2015/position-sticky.html">
<meta property="og:site_name" content="1000ch.net">
<meta property="og:title" content="position-stickyについて調べたメモ">

<meta name="twitter:site" content="@1000ch">
<meta name="twitter:url" content="https://1000ch.net/posts/2015/position-sticky.html">
<meta name="twitter:title" content="position-stickyについて調べたメモ">

<meta name="google-site-verification" content="BWewniqiBzRmrhpj51eLwug-F4hamFfyznl-ARb-Y4Y">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon.png">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-49530352-1', '1000ch.net');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div class="Container">
      <header class="Header">
  <h1 class="Header__Title"><a href="/">1000ch.net</a></h1>
  <nav class="Header__Menu">
    <div class="Header__MenuItem">
      <i class="fa fa-rss"></i>
      <a href="/rss.xml">RSS</a>
    </div>
    <div class="Header__MenuItem">
      <i class="fa fa-heart"></i>
      <a href="/activity.html">Activity</a>
    </div>
    <div class="Header__MenuItem">
      <i class="fa fa-facebook-square"></i>
      <a href="https://www.facebook.com/1000ch.net">Facebook</a>
    </div>
  </nav>
</header>

      <div class="Main">
        <span class="Label Label--gray pull-left">2015.03.31</span>

        

<h1 id="position-stickyについて調べたメモ:bbed5d587fa747803ba060ffb50bdc86">position-stickyについて調べたメモ</h1>

<p>業務中に<code>position: sticky;</code>的な表現をする必要があって、JavaScriptで実装したり、その辺の仕様がどうなってるのか調べたメモ。スティッキーの挙動を言葉で説明するのは難しいので、デモを見てもらったほうが話が早い。</p>

<ul>
<li><a href="http://filamentgroup.github.io/fixed-sticky/demos/demo.html">Fixed-sticky - filamentgroup</a></li>
<li><a href="http://philipwalton.github.io/polyfill/demos/position-sticky/">Demo: Position Sticky</a></li>
</ul>

<p>広告をスクロールに応じて一定位置まで追従させたいシーン等によく利用されているイメージ。範囲が限定されている<code>position: fixed;</code>と言えばいいんだろうか。</p>

<h2 id="スペックなど:bbed5d587fa747803ba060ffb50bdc86">スペックなど</h2>

<ul>
<li><a href="https://lists.w3.org/Archives/Public/www-style/2012Jun/0627.html">Sticky Positioning from Edward O&rsquo;Connor on 2012-06-26 (www-style@w3.org from June 2012)</a></li>
<li><a href="http://dev.w3.org/csswg/css-position/#sticky-pos">6.2. Sticky positioning</a> - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module</li>
<li><a href="http://dev.w3.org/csswg/css-position/#position-property">6.7. Choosing a positioning scheme: position property</a> - W3C Editor&rsquo;s Draft - CSS Positioned Layout Module</li>
</ul>

<p>仕様は生きているようだけど、Chromeで使えない。と、いうか、途中まで（35くらいまで？）はフラグ付きで使えたような気がしてたけど、使えなくなってた。各種ログを追ってみると実装が途中で削除された形跡がある。</p>

<ul>
<li><a href="http://stackoverflow.com/questions/15646747/why-doesnt-position-sticky-work-in-chrome">Why doesn&rsquo;t position: sticky work in Chrome?</a> - Stack Overflow</li>
<li><a href="https://code.google.com/p/chromium/issues/detail?id=231752">Issue 231752: Meta bug for position:sticky</a> - Chromium Dashboard</li>
</ul>

<blockquote>
<p>Remove position: sticky</p>

<p>We would eventually like to implement position: sticky, but the current implementation isn&rsquo;t designed in a way that integrates well with the existing scrolling and compositing system. For example, position: sticky relies upon <code>updateLayerPositionsAfterDocumentScroll</code> to function correctly, but that function has no other purpose and can otherwise be removed. Similarly, <code>position: sticky</code> doesn&rsquo;t work at all with composited overflow scrolling, which is now the default mechanism for driving scrolling in the engine.</p>

<p>Once we&rsquo;ve got our scrolling and compositing house in order, we should return to position: sticky and implement the feature in a way that integrates well with the rest of the engine. For now, however, this CL removes our current implementation so we can focus on improving our implementation of the scrolling
features we&rsquo;ve already shipped.</p>
</blockquote>

<p>だそうです。待ちましょう。</p>

<h3 id="feature-detectionの方法:bbed5d587fa747803ba060ffb50bdc86">Feature Detectionの方法</h3>

<p>スニペット的な。</p>

<pre><code class="language-js">var div = document.createElement(&quot;div&quot;);
div.style.position = &quot;sticky&quot;;
console.log(div.style.position.indexOf(&quot;sticky&quot;) !== -1);
</code></pre>

<h2 id="javascriptでエミュレーション:bbed5d587fa747803ba060ffb50bdc86">JavaScriptでエミュレーション</h2>

<p>結論、2015年3月末の段階では<a href="http://caniuse.com/#search=sticky">ブラウザ対応がイマイチ</a>なのでJavaScriptでアレコレする必要がある。以下は有名処の実装。いずれもjQueryのプラグイン。</p>

<ul>
<li><a href="https://github.com/filamentgroup/fixed-sticky">filamentgroup/fixed-sticky</a> filament groupによる実装</li>
<li><a href="https://github.com/philipwalton/polyfill/tree/master/demos/position-sticky">philipwalton/polyfill</a> Philip Waltonによる実装</li>
</ul>

<p>jQuery非依存が良かったので自分で書き直した。</p>

<ul>
<li><a href="https://github.com/1000ch/position-sticky">1000ch/position-sticky</a></li>
</ul>

<p>自分の実装も、はじめはPhilip Waltonの実装と同じように、stickyとしたい要素をクローン→クローンした要素に<code>position: fixed;</code>を適用→クローン元を<code>visiblity: hidden;</code>のような処理をしていたけど、対象要素に自動再生される<code>&lt;video autoplay&gt;</code>があったりすると、もろともクローンされてしまい動画が2つ再生されてしまうといったような不都合があったので、クローンしないように実装を直してある。</p>

<p>工夫を凝らしている最中だが、こういうレイアウトに関する記述はCSSにある方が精神衛生的に良いし、メディアクエリと連携させる場合の面倒臭さはどうしてもあるので、やはりブラウザネイティブの欲しいなと思ったのでした。普通だ。</p>

<p>そんだけ。</p>

        <aside class="Share">
  <div class="Share__Item">
     <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2f1000ch.net%2fposts%2f2015%2fposition-sticky.html" title="Share on Facebook" target="_blank">
       <i class="fa fa-facebook-square"></i>
     </a>
  </div>
  <div class="Share__Item">
    <a href="https://twitter.com/share?url=https%3a%2f%2f1000ch.net%2fposts%2f2015%2fposition-sticky.html&text=position-sticky%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%e8%aa%bf%e3%81%b9%e3%81%9f%e3%83%a1%e3%83%a2" title="Share on Twitter" target="_blank">
      <i class="fa fa-twitter-square"></i>
    </a>
  </div>
  <div class="Share__Item">
    <a href="https://plus.google.com/share?url=https%3a%2f%2f1000ch.net%2fposts%2f2015%2fposition-sticky.html" title="Share on Google+" target="_blank">
      <i class="fa fa-google-plus-square"></i>
    </a>
  </div>
</aside>

<nav class="Pager">
  
    <div class="Pager__Item Pager__Item--left">
      <i class="fa fa-arrow-left"></i>
      <a href="/posts/2015/html-css-common-sense.html">現場のプロが教えるHTML&#43;CSSコーディングの最新常識</a>
    </div>
  

  
    <div class="Pager__Item Pager__Item--right">
      <a href="/posts/2015/dotfiles.html">dotfilesを整理した</a>
      <i class="fa fa-arrow-right"></i>
    </div>
  
</nav>

      </div>
      <aside class="Aside">
  <h1>Author</h1>
  <div class="Media">
    <img class="Media__figure" src="/img/1000ch.jpg" alt="1000ch" width="96" height="96">
    <div class="Media__body">
      <div class="Media__title">1000ch <a href="https://twitter.com/1000ch" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @1000ch</a></div>
      <div class="Media__description">
        渋谷で働くソフトウェアエンジニア。Web Standards、パフォーマンス、アクセシビリティあたりのキーワードに反応します。
      </div>
    </div>
  </div>
</aside>

      <footer class="Footer">
  <div class="Banner">
    <div class="Banner__Item">
      <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.ja" target="_blank">
        <img src="/img/by-nc-nd.png" alt="CC BY-NC-ND 4.0" width="80" height="28">
      </a>
    </div>
    <div class="Banner__Item">
      <a href="https://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fhttps%3A%2F%2F1000ch.net%2Findex.xml" target="_blank">
        <img src="https://s3.feedly.com/img/follows/feedly-follow-rectangle-flat-medium_2x.png" alt="follow me on feedly" width="71" height="28">
      </a>
    </div>
    <div class="Banner__Item">
      <form action="https://duckduckgo.com/" role="search">
        <input name="sites" type="hidden" value="1000ch.net">
        <input name="q" type="search">
        <input type="submit" value="Search">
      </form>
    </div>
  </div>
</footer>

    </div>
    <script async src="//apis.google.com/js/plusone.js"></script>
<script async src="//platform.twitter.com/widgets.js"></script>
<script async src="//platform.instagram.com/en_US/embeds.js"></script>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
<script src="/js/app.min.js"></script>

  </body>
</html>
